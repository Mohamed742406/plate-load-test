<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform: Plate Load Test (ASTM & DIN)</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© ÙˆÙ…ÙˆØ­Ø¯Ø© --- */
        body { font-family: 'Cairo', sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ */
        .main-nav { background: #2c3e50; padding: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: sticky; top:0; z-index: 1000; }
        .std-btn { 
            background: transparent; color: #ecf0f1; border: 2px solid #ecf0f1; 
            padding: 8px 25px; margin: 0 10px; border-radius: 30px; 
            font-weight: bold; cursor: pointer; transition: all 0.3s; font-size: 1.1em;
        }
        .std-btn:hover, .std-btn.active { background: #e67e22; color: white; border-color: #e67e22; transform: scale(1.05); }
        
        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªÙ‚Ø±ÙŠØ± (Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ÙƒÙ„) */
        .report-container { max-width: 210mm; margin: 30px auto; background: white; padding: 40px; box-shadow: 0 0 20px rgba(0,0,0,0.1); min-height: 297mm; }
        
        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: center; font-size: 13px; vertical-align: middle; }
        th { background-color: #e8e8e8; font-weight: bold; }
        
        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section-title { background-color: #d4d4d4; padding: 10px 12px; font-weight: bold; border: 1px solid #333; margin-top: 25px; text-align: center; margin-bottom: 10px; }
        .ar-text { font-weight: 700; font-size: 1.1em; display: block; color: #000; }
        .en-sub { font-size: 0.8em; color: #555; font-weight: normal; display: block; }
        
        /* Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© (Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ÙˆØ­) */
        .plate-info-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 15px; margin-bottom: 20px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .plate-info-box label { color: white; font-weight: bold; margin-right: 10px; }
        .plate-info-box input { background: rgba(255,255,255,0.9); border: none; border-radius: 4px; padding: 5px 10px; text-align: center; font-weight: bold; color: #333; }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
        input[type="text"], input[type="number"], input[type="date"] {
            width: 95%; border: none; text-align: center; background: transparent; font-family: 'Cairo'; border-bottom: 1px dashed #ccc;
        }
        input:focus { outline: none; border-bottom: 2px solid #0066cc; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn { padding: 6px 15px; margin: 2px; border-radius: 4px; color: white; cursor: pointer; border: none; font-size: 0.9em; font-family: 'Cairo'; }
        .btn-primary { background-color: #0066cc; }
        .btn-success { background-color: #28a745; }
        .btn-danger { background-color: #dc3545; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .btn-info { background-color: #17a2b8; color: white; }
        
        /* Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± */
        .view-section { display: none; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print, .main-nav { display: none !important; }
            .view-section { display: none; }
            .view-section.active { display: block !important; }
            .tab-content { display: block !important; opacity: 1 !important; visibility: visible !important; height: auto !important; }
            .nav-buttons { display: none !important; }
            .page-break { page-break-before: always; }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; }
            body { padding: 0; margin: 0; font-size: 10pt; background: white; }
            .report-container { box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 0; }
            .tabs-nav { display: none !important; }
            #tab1Content, #tab2Content { page-break-after: always; border-bottom: none !important; }
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ø¨ØªØ¨ÙˆÙŠØ¨Ø§Øª ASTM */
        .tabs-nav { display: flex; border-bottom: 3px solid #0066cc; margin-bottom: 20px; background: #f8f9fa; }
        .tab-btn { flex: 1; padding: 10px; cursor: pointer; border: none; transition: 0.3s; }
        .tab-btn.active { background: #0066cc; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .load-step-title { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 5px; margin: 15px 0 10px 0; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .load-step-title input { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; text-align: center; font-weight: bold; max-width: 200px; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px; border-top: 2px solid #e9ecef; }
        .mpa-input { background-color: #fffde7 !important; border-bottom: 1px dashed #fbc02d !important; }
    </style>
</head>
<body>

    <div class="main-nav no-print">
        <button class="std-btn active" onclick="switchStandard('ASTM')">ASTM D1194</button>
        <button class="std-btn" onclick="switchStandard('DIN')">DIN 18134</button>
    </div>

    <div id="view-ASTM" class="view-section active">
        <div class="report-container">
            <div class="flex items-center justify-between mb-6 border-b-2 border-gray-800 pb-4">
                <div class="w-1/4 text-center">
                    <img id="logo_astm" src="#" class="max-h-24 hidden mx-auto">
                    <div class="no-print mt-2"><label class="cursor-pointer bg-gray-200 px-2 py-1 rounded text-xs">ğŸ“· Logo<input type="file" class="hidden" onchange="loadLogo(event, 'logo_astm')"></label></div>
                </div>
                <div class="w-2/4 text-center">
                    <h1 class="text-2xl font-bold">ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ­<br><span class="text-base font-normal text-gray-600">PLATE LOAD TEST REPORT (ASTM D1194)</span></h1>
                </div>
                <div class="w-1/4"></div>
            </div>

            <div class="no-print mb-4 text-center">
                <button onclick="window.print()" class="btn btn-success">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>

            <div class="section-title"><span class="ar-text">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><small class="en-sub">PROJECT INFORMATION</small></div>
            <table>
                <tr><td class="bg-gray-100 font-bold w-1/4">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</td><td><input type="text" id="projectName"></td><td class="bg-gray-100 font-bold w-1/4">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</td><td><input type="text" id="orderNo"></td></tr>
                <tr><td class="bg-gray-100 font-bold">Ø§Ù„Ø¹Ù…ÙŠÙ„</td><td><input type="text" id="client"></td><td class="bg-gray-100 font-bold">Ø§Ù„ØªØ§Ø±ÙŠØ®</td><td><input type="date" id="astmDate"></td></tr>
                <tr><td class="bg-gray-100 font-bold">Ø§Ù„Ù…ÙˆÙ‚Ø¹</td><td><input type="text" id="location"></td><td class="bg-gray-100 font-bold">Ø±Ù‚Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</td><td><input type="text"></td></tr>
            </table>

            <div class="bg-blue-50 p-4 rounded mb-4 border border-blue-200 no-print">
                <div class="flex justify-center gap-6 items-center flex-wrap">
                    <label class="font-bold text-blue-900">Unit: <select id="gauge_unit" class="p-1 border rounded" onchange="updateCalculations()"><option value="MPa">MPa</option><option value="Bar">Bar</option><option value="psi">psi</option><option value="kg_cm2">kg/cmÂ²</option></select></label>
                    <label class="font-bold text-blue-900">Design Load: <input type="number" id="design_load" class="bg-white p-1 w-20 border rounded" oninput="autoUpdateStages()"> kg/cmÂ²</label>
                </div>
            </div>

            <div class="plate-info-box no-print">
                <div class="flex justify-center gap-10 items-center">
                    <div><label>Ù‚Ø·Ø± Ø§Ù„Ù„ÙˆØ­ (Ø³Ù…):</label><input type="number" id="astm_dia" value="45.72" oninput="calculatePlateArea()"></div>
                    <div class="text-2xl">â†’</div>
                    <div><label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ø³Ù…Â²):</label><input type="text" id="astm_area" readonly></div>
                    <div class="border-l pl-4"><label>Ram Factor:</label><input type="number" id="astm_ram" value="16.428"></div>
                </div>
            </div>

            <div class="tabs-nav no-print">
                <button class="tab-btn active" onclick="switchTab(1)">Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
                <button class="tab-btn" onclick="switchTab(2)">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±ÙØ¹</button>
                <button class="tab-btn" onclick="switchTab(3)">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ù…Ù†Ø­Ù†Ù‰</button>
            </div>

            <div id="tab1Content" class="tab-content active">
                <div class="section-title"><span class="ar-text">Ø£- Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</span><small class="en-sub">A- LOADING STAGE</small></div>
                
                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel1" value="0.70 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load1')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load1"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel2" value="1.40 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load2')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load2"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel3" value="2.10 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load3')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load3"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel4" value="2.80 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load4')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load4"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel5" value="3.50 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load5')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load5"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span></div><input type="text" id="loadingStageLabel6" value="4.20 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('load6')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_load6"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="nav-buttons no-print"><div></div><button onclick="switchTab(2)" class="btn btn-primary btn-nav"><span class="ar-text">Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</span> â†’</button></div>
            </div>

            <div id="tab2Content" class="tab-content">
                <div class="section-title"><span class="ar-text">Ø¨- Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±ÙØ¹</span><small class="en-sub">B- UNLOADING STAGE</small></div>
                
                <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±ÙØ¹</span></div><input type="text" id="unloadingStageLabel1" value="2.80 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('unload1')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_unload1"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±ÙØ¹</span></div><input type="text" id="unloadingStageLabel2" value="1.40 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('unload2')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_unload2"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±ÙØ¹</span></div><input type="text" id="unloadingStageLabel3" value="0.00 kg/cmÂ²"></div>
                <div class="no-print mb-2 mt-2 text-center"><button onclick="addAstmRow('unload3')" class="btn btn-primary">+ ØµÙ</button></div>
                <table id="table_unload3"><thead><tr><th>Time</th><th class="bg-yellow-50">Gauge <span class="unit-disp"></span></th><th class="bg-gray-50">Load</th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th class="no-print">X</th></tr></thead><tbody></tbody></table>

                <div class="nav-buttons no-print">
                    <button onclick="switchTab(1)" class="btn btn-warning btn-nav">â† Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                    <button onclick="switchTab(3)" class="btn btn-primary btn-nav">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
                </div>
            </div>

            <div id="tab3Content" class="tab-content">
                <div class="section-title"><span class="ar-text">Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span><small class="en-sub">SUMMARY OF RESULTS</small></div>
                <div class="no-print text-center mb-2"><button class="btn btn-primary" onclick="autoFillSummary()">ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</button></div>
                <table id="summaryTable">
                    <thead><tr class="bg-gray-200"><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ø­Ù…Ù„ (Ø·Ù†)</th><th>Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ (kg/cmÂ²)</th><th>Ø§Ù„Ù‡Ø¨ÙˆØ· (Ù…Ù…)</th></tr></thead>
                    <tbody id="summaryBody"></tbody>
                </table>

                <div class="section-title page-break"><span class="ar-text">Ø§Ù„Ù…Ù†Ø­Ù†ÙŠØ§Øª</span><small class="en-sub">LOAD-SETTLEMENT CURVE</small></div>
                <div style="height: 500px; border:1px solid #ddd; padding:10px;"><canvas id="chartASTM"></canvas></div>

                <div class="mt-6 p-6 bg-indigo-50 border border-indigo-200 rounded-lg text-center">
                    <h3 class="text-indigo-900 font-bold text-xl mb-2">Ù…Ø¹Ø§Ù…Ù„ Ø±Ø¯ ÙØ¹Ù„ Ø§Ù„ØªØ±Ø¨Ø© (K-Value)</h3>
                    <div class="text-4xl font-bold text-indigo-700 ltr" id="res_k_value">0.00 kg/cmÂ³</div>
                    <p class="text-sm text-gray-500 mt-2">* Calculated based on max loading point (P/Î”)</p>
                </div>
            </div>

            <div class="mt-10 pt-4 border-t-2 border-gray-400 flex justify-between text-center px-10">
                <div><div class="font-bold mb-8">ÙØ­Øµ Ø¨ÙˆØ§Ø³Ø·Ø©</div><input type="text" class="text-center" placeholder="Ø§Ù„Ø§Ø³Ù…"></div>
                <div><div class="font-bold mb-8">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©</div><input type="text" class="text-center" placeholder="Ø§Ù„Ø§Ø³Ù…"></div>
                <div><div class="font-bold mb-8">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø©</div><input type="text" class="text-center" placeholder="Ø§Ù„Ø§Ø³Ù…"></div>
            </div>
        </div>
    </div>

    <div id="view-DIN" class="view-section">
        <div class="report-container">
            <div class="flex items-center justify-between mb-6 border-b-2 border-gray-800 pb-4">
                <div class="w-1/4 text-center">
                    <img id="logo_din" src="#" class="max-h-24 hidden mx-auto">
                    <div class="no-print mt-2"><label class="cursor-pointer bg-gray-200 px-2 py-1 rounded text-xs">ğŸ“· Logo<input type="file" class="hidden" onchange="loadLogo(event, 'logo_din')"></label></div>
                </div>
                <div class="w-2/4 text-center">
                    <h1 class="text-2xl font-bold">ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ­ (Ø£Ù„Ù…Ø§Ù†ÙŠ)<br><span class="text-base font-normal text-gray-600">PLATE LOAD TEST (DIN 18134)</span></h1>
                </div>
                <div class="w-1/4"></div>
            </div>

            <div class="no-print mb-4 text-center">
                <button onclick="window.print()" class="btn btn-success">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>

            <div class="section-title"><span class="ar-text">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><small class="en-sub">PROJECT INFORMATION</small></div>
            <table>
                <tr><td class="bg-gray-100 font-bold w-1/4">Project Name</td><td><input type="text"></td><td class="bg-gray-100 font-bold w-1/4">Report No.</td><td><input type="text"></td></tr>
                <tr><td class="bg-gray-100 font-bold">Client</td><td><input type="text"></td><td class="bg-gray-100 font-bold">Date</td><td><input type="date" id="dinDate"></td></tr>
                <tr><td class="bg-gray-100 font-bold">Location</td><td><input type="text"></td><td class="bg-gray-100 font-bold">Test No.</td><td><input type="text"></td></tr>
            </table>

            <div class="plate-info-box no-print">
                <div class="flex justify-center gap-10 items-center">
                    <div><label>Plate Diameter (d):</label><input type="number" id="din_dia" value="300" oninput="updateDinRad()" style="width:80px;"> mm</div>
                    <div class="text-2xl">â†’</div>
                    <div><label>Radius (r):</label><span id="din_rad" class="font-bold text-xl">150</span> mm</div>
                </div>
            </div>

            <div class="section-title"><span class="ar-text">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span><small class="en-sub">TEST DATA (3 CYCLES)</small></div>

            <div class="mb-6">
                <div class="bg-gray-200 p-2 font-bold text-center border border-gray-400 border-b-0">1st Loading Cycle (Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„Ù‰)</div>
                <table id="dinTable1" class="mb-0">
                    <thead><tr class="bg-gray-100"><th>Stress Ïƒ0 (MN/mÂ²)</th><th>Settlement s (mm)</th><th class="no-print w-12">Action</th></tr></thead>
                    <tbody></tbody>
                </table>
                <div class="no-print text-center bg-gray-50 border border-t-0 p-2"><button class="btn btn-primary" onclick="addDinRow('dinTable1')">+ Add Row</button></div>
            </div>

            <div class="mb-6">
                <div class="bg-gray-200 p-2 font-bold text-center border border-gray-400 border-b-0">Unloading (Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙØ±ÙŠØº)</div>
                <table id="dinTableUnload" class="mb-0">
                    <thead><tr class="bg-gray-100"><th>Stress Ïƒ0 (MN/mÂ²)</th><th>Settlement s (mm)</th><th class="no-print w-12">Action</th></tr></thead>
                    <tbody></tbody>
                </table>
                <div class="no-print text-center bg-gray-50 border border-t-0 p-2"><button class="btn btn-primary" onclick="addDinRow('dinTableUnload')">+ Add Row</button></div>
            </div>

            <div class="mb-6">
                <div class="bg-gray-200 p-2 font-bold text-center border border-gray-400 border-b-0">2nd Loading Cycle (Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠØ©)</div>
                <table id="dinTable2" class="mb-0">
                    <thead><tr class="bg-gray-100"><th>Stress Ïƒ0 (MN/mÂ²)</th><th>Settlement s (mm)</th><th class="no-print w-12">Action</th></tr></thead>
                    <tbody></tbody>
                </table>
                <div class="no-print text-center bg-gray-50 border border-t-0 p-2"><button class="btn btn-primary" onclick="addDinRow('dinTable2')">+ Add Row</button></div>
            </div>

            <div class="no-print text-center mt-8 mb-8">
                <button class="btn btn-success text-lg px-8 py-2" onclick="calcDIN()">ğŸš€ Calculate Ev Results</button>
            </div>

            <div class="section-title page-break"><span class="ar-text">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ù…Ù†Ø­Ù†ÙŠØ§Øª</span><small class="en-sub">RESULTS & CURVES</small></div>
            
            <div class="mt-6 p-6 bg-indigo-50 border border-indigo-200 rounded-lg text-center shadow-sm">
                <div class="flex justify-around items-center flex-wrap">
                    <div>
                        <div class="text-gray-600 font-bold mb-1">Strain Modulus Ev1</div>
                        <div class="text-3xl font-bold text-blue-800 dir-ltr" id="res_ev1">0.00 MN/mÂ²</div>
                    </div>
                    <div class="text-gray-300 text-4xl">|</div>
                    <div>
                        <div class="text-gray-600 font-bold mb-1">Strain Modulus Ev2</div>
                        <div class="text-3xl font-bold text-green-800 dir-ltr" id="res_ev2">0.00 MN/mÂ²</div>
                    </div>
                    <div class="text-gray-300 text-4xl">|</div>
                    <div>
                        <div class="text-gray-600 font-bold mb-1">Ratio (Ev2/Ev1)</div>
                        <div class="text-4xl font-extrabold text-orange-600" id="res_ratio">0.00</div>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-4 dir-ltr">Formula: Ev = 1.5 * r * 1 / (a1 + a2 * Ïƒ0max)</p>
            </div>

            <div class="mt-6" style="height: 500px; border:1px solid #ddd; padding:10px;">
                <canvas id="chartDIN"></canvas>
            </div>

            <div class="mt-10 pt-4 border-t-2 border-gray-400 flex justify-between text-center px-10">
                <div><div class="font-bold mb-8">Tested By</div><input type="text" class="text-center" placeholder="Name"></div>
                <div><div class="font-bold mb-8">Checked By</div><input type="text" class="text-center" placeholder="Name"></div>
                <div><div class="font-bold mb-8">Approved By</div><input type="text" class="text-center" placeholder="Name"></div>
            </div>
        </div>
    </div>

    <script>
        // --- Shared ---
        function switchStandard(std) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.std-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + std).classList.add('active');
            const btns = document.querySelectorAll('.std-btn');
            if(std === 'ASTM') btns[0].classList.add('active'); else btns[1].classList.add('active');
        }

        function loadLogo(e, id) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const img = document.getElementById(id);
                    img.src = evt.target.result;
                    img.classList.remove('hidden');
                    e.target.parentElement.style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        }

        /* --- ASTM LOGIC --- */
        let chartASTM_Obj = null;

        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('astmDate').valueAsDate = new Date();
            document.getElementById('dinDate').valueAsDate = new Date();
            calculatePlateArea();
            
            // Add initial rows to all ASTM tables
            ['load1','load2','load3','load4','load5','load6','unload1','unload2','unload3'].forEach(id => addAstmRow(id));
            
            // Init DIN Rows
            addDinRow('dinTable1'); addDinRow('dinTable1');
            addDinRow('dinTableUnload');
            addDinRow('dinTable2'); addDinRow('dinTable2');
        });

        function calculatePlateArea() {
            const d = parseFloat(document.getElementById('astm_dia').value);
            if(d) document.getElementById('astm_area').value = (Math.PI * Math.pow(d/2, 2)).toFixed(2);
        }

        function switchTab(n) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab'+n+'Content').classList.add('active');
            document.querySelectorAll('.tab-btn')[n-1].classList.add('active');
            if(n===3) setTimeout(recalcASTM, 100);
        }

        function addAstmRow(tableKey) {
            const tbody = document.querySelector(`#table_${tableKey} tbody`);
            const row = tbody.insertRow();
            row.innerHTML = `
                <td><input type="text" placeholder="00:00"></td>
                <td class="bg-yellow-50"><input type="number" step="0.01" class="gauge-input" oninput="calcAstmRow(this)"></td>
                <td class="bg-gray-50"><input type="number" class="load-input" readonly></td>
                <td><input type="number" class="g-input" oninput="calcAstmRow(this)"></td>
                <td><input type="number" class="g-input" oninput="calcAstmRow(this)"></td>
                <td><input type="number" class="g-input" oninput="calcAstmRow(this)"></td>
                <td class="calculated avg-cell">-</td>
                <td class="calculated sett-cell">-</td>
                <td class="stress-calculated stress-cell">-</td>
                <td class="no-print"><button class="btn btn-danger text-xs" onclick="this.closest('tr').remove()">x</button></td>
            `;
        }

        function autoUpdateStages() {
            const des = parseFloat(document.getElementById('design_load').value);
            if(!des) return;
            const steps = [0.25, 0.50, 0.75, 1.00, 1.50, 2.00];
            for(let i=1; i<=6; i++) document.getElementById(`loadingStageLabel${i}`).value = (des * steps[i-1]).toFixed(2) + " kg/cmÂ²";
            document.getElementById(`unloadingStageLabel1`).value = (des * 1.00).toFixed(2) + " kg/cmÂ²";
            document.getElementById(`unloadingStageLabel2`).value = (des * 0.50).toFixed(2) + " kg/cmÂ²";
            document.getElementById(`unloadingStageLabel3`).value = "0.00 kg/cmÂ²";
        }

        function updateCalculations() {
            const u = document.getElementById('gauge_unit').value;
            document.querySelectorAll('.unit-disp').forEach(s => s.innerText = `(${u})`);
            document.querySelectorAll('.gauge-input').forEach(inp => calcAstmRow(inp));
        }

        function calcAstmRow(inp) {
            const row = inp.closest('tr');
            const gVal = parseFloat(row.querySelector('.gauge-input').value);
            const unit = document.getElementById('gauge_unit').value;
            const ram = parseFloat(document.getElementById('astm_ram').value);
            const area = parseFloat(document.getElementById('astm_area').value);

            if(!isNaN(gVal) && ram && area) {
                let mpa = (unit=='MPa')?gVal : (unit=='Bar')?gVal/10 : (unit=='psi')?gVal/145.038 : gVal/10.197;
                let load = mpa * ram;
                row.querySelector('.load-input').value = load.toFixed(2);
                row.querySelector('.stress-cell').innerText = ((load*1000)/area).toFixed(2);
            }

            let sum=0, c=0;
            row.querySelectorAll('.g-input').forEach(i => { if(i.value!=='') {sum+=parseFloat(i.value); c++;} });
            if(c===3) {
                let avg = sum/3;
                row.querySelector('.avg-cell').innerText = avg.toFixed(3);
                row.querySelector('.sett-cell').innerText = (avg*0.001).toFixed(3); 
            }
        }

        function autoFillSummary() {
            const body = document.getElementById('summaryBody');
            body.innerHTML = '';
            body.innerHTML += `<tr><td>Start</td><td>0</td><td>0</td><td>0</td></tr>`;
            
            for(let i=1; i<=6; i++) {
                const trs = document.querySelectorAll(`#table_load${i} tbody tr`);
                if(trs.length > 0) {
                    const last = trs[trs.length-1];
                    const l = last.querySelector('.load-input').value;
                    const s = last.querySelector('.stress-cell').innerText;
                    const sett = last.querySelector('.sett-cell').innerText;
                    if(l) body.innerHTML += `<tr><td>Load ${i}</td><td>${l}</td><td>${s}</td><td>${sett}</td></tr>`;
                }
            }
            for(let i=1; i<=3; i++) {
                const trs = document.querySelectorAll(`#table_unload${i} tbody tr`);
                if(trs.length > 0) {
                    const last = trs[trs.length-1];
                    const l = last.querySelector('.load-input').value;
                    const s = last.querySelector('.stress-cell').innerText;
                    const sett = last.querySelector('.sett-cell').innerText;
                    if(l) body.innerHTML += `<tr><td>Unload ${i}</td><td>${l}</td><td>${s}</td><td>${sett}</td></tr>`;
                }
            }
            recalcASTM();
        }

        function recalcASTM() {
            const rows = document.querySelectorAll('#summaryBody tr');
            let data = [];
            rows.forEach(r => {
                const cells = r.cells;
                if(cells.length > 3) {
                    let s = parseFloat(cells[2].innerText);
                    let sett = parseFloat(cells[3].innerText);
                    if(!isNaN(s)) data.push({x:s, y:sett});
                }
            });

            if(data.length > 0) {
                let max = data.reduce((p, c) => (p.x > c.x) ? p : c);
                let k = max.y > 0 ? max.x / (max.y/10) : 0;
                document.getElementById('res_k_value').innerText = k.toFixed(2) + " kg/cmÂ³";
            }

            if(chartASTM_Obj) chartASTM_Obj.destroy();
            const ctx = document.getElementById('chartASTM').getContext('2d');
            chartASTM_Obj = new Chart(ctx, {
                type: 'line',
                data: { datasets: [{ label: 'Load-Settlement', data: data, borderColor: '#1F4E79', backgroundColor: '#C00000', pointStyle:'rectRot', pointRadius:6, tension:0 }] },
                options: { responsive:true, maintainAspectRatio:false, scales:{ x:{type:'linear', position:'top', title:{display:true, text:'Stress (kg/cmÂ²)'}}, y:{reverse:true, title:{display:true, text:'Settlement (mm)'}} } }
            });
        }

        /* --- DIN LOGIC --- */
        function updateDinRad() {
            document.getElementById('din_rad').innerText = (document.getElementById('din_dia').value / 2).toFixed(1);
        }

        function addDinRow(id) {
            const tbody = document.querySelector(`#${id} tbody`);
            const row = tbody.insertRow();
            row.innerHTML = `<td><input type="number" step="0.01"></td><td><input type="number" step="0.01"></td><td class="no-print"><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove()">x</button></td>`;
        }

        function polyFit(points) {
            if (typeof math === 'undefined' || points.length < 3) return [0,0,0];
            let n = points.length;
            let sx=0, sx2=0, sx3=0, sx4=0, sy=0, sxy=0, sx2y=0;
            for(let p of points) {
                let x=p.x, y=p.y;
                sx+=x; sx2+=x*x; sx3+=x*x*x; sx4+=x*x*x*x;
                sy+=y; sxy+=x*y; sx2y+=x*x*y;
            }
            let A = [[n, sx, sx2], [sx, sx2, sx3], [sx2, sx3, sx4]];
            let B = [sy, sxy, sx2y];
            try {
                let X = math.lusolve(A, B);
                return [Number(X[0]), Number(X[1]), Number(X[2])];
            } catch(e) { return [0,0,0]; }
        }

        let chartDIN_Obj = null;

        function calcDIN() {
            let getData = (id) => {
                let arr = [];
                document.querySelectorAll(`#${id} tbody tr`).forEach(tr => {
                    let ins = tr.querySelectorAll('input');
                    let s = parseFloat(ins[0].value), set = parseFloat(ins[1].value);
                    if(!isNaN(s) && !isNaN(set)) arr.push({x:s, y:set});
                });
                return arr;
            };

            let data1 = getData('dinTable1');
            let dataUn = getData('dinTableUnload');
            let data2 = getData('dinTable2');

            if(data1.length < 3) { alert("Add data to Cycle 1"); return; }

            let r = parseFloat(document.getElementById('din_rad').innerText);
            let sigma_max1 = data1[data1.length-1].x;

            let coeffs1 = polyFit(data1.slice(1)); 
            let Ev1 = 1.5 * r * (1 / (coeffs1[1] + coeffs1[2] * sigma_max1));

            let coeffs2 = polyFit(data2);
            let Ev2 = 1.5 * r * (1 / (coeffs2[1] + coeffs2[2] * sigma_max1));

            document.getElementById('res_ev1').innerText = Ev1.toFixed(2) + " MN/mÂ²";
            document.getElementById('res_ev2').innerText = Ev2.toFixed(2) + " MN/mÂ²";
            document.getElementById('res_ratio').innerText = (Ev2/Ev1).toFixed(2);

            let genCurve = (c, max) => {
                let pts=[]; 
                for(let x=0; x<=max; x+=max/20) pts.push({x:x, y:c[0]+c[1]*x+c[2]*x*x});
                return pts;
            };
            let c1 = genCurve(coeffs1, sigma_max1);
            let c2 = genCurve(coeffs2, data2[data2.length-1].x);

            if(chartDIN_Obj) chartDIN_Obj.destroy();
            const ctx = document.getElementById('chartDIN').getContext('2d');
            chartDIN_Obj = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        { label: 'Cycle 1', data: data1, backgroundColor:'blue' },
                        { label: 'Fit 1', data: c1, type:'line', borderColor:'blue', pointRadius:0, fill:false },
                        { label: 'Unload', data: dataUn, type:'line', borderColor:'gray', borderDash:[5,5], fill:false },
                        { label: 'Cycle 2', data: data2, backgroundColor:'green' },
                        { label: 'Fit 2', data: c2, type:'line', borderColor:'green', pointRadius:0, fill:false }
                    ]
                },
                options: {
                    scales: { x:{type:'linear', position:'top', title:{display:true, text:'Stress (MN/mÂ²)'}}, y:{reverse:true, title:{display:true, text:'Settlement (mm)'}} }
                }
            });
        }
    </script>
</body>
</html>
