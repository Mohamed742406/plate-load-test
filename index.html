<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ­ | Plate Load Test Report (ASTM D1194)</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            .tab-content { display: block !important; }
            body { font-size: 10pt; }
            .page-break { page-break-before: always; }
            table { page-break-inside: avoid; }
            .print-compact { padding: 0.25rem !important; }
            .tabs-nav { display: none !important; }
        }
        
        body {
            font-family: 'Cairo', 'Times New Roman', Times, serif;
            background-color: #f5f5f5;
        }
        
        .report-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        @media print {
            .report-container {
                box-shadow: none;
                max-width: 100%;
            }
        }
        
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #333; padding: 6px 8px; text-align: center; font-size: 12px; vertical-align: middle; }
        th { background-color: #e8e8e8; font-weight: bold; line-height: 1.4; }
        
        .ar-text { font-weight: 700; font-size: 1em; color: #1a1a1a; display: block; }
        .en-sub { font-size: 0.75em; color: #555; font-weight: normal; display: block; margin-top: 2px; }
        .bilingual-label { text-align: center; line-height: 1.3; }
        .label-cell { background-color: #f5f5f5; font-weight: bold; }
        
        input[type="text"], input[type="number"], input[type="date"] {
            border: none; border-bottom: 1px solid #999; padding: 4px; width: 100%; text-align: center; background: transparent; font-family: 'Cairo', Arial, sans-serif;
        }
        input:focus { outline: none; border-bottom-color: #0066cc; }
        input[readonly] { background-color: #e8f4fc; border-bottom: 2px solid #0066cc; font-weight: bold; color: #0066cc; }
        
        .section-title { background-color: #d4d4d4; padding: 10px 12px; font-weight: bold; border: 1px solid #333; margin-top: 20px; text-align: center; }
        .section-title .ar-text { font-size: 1.1em; }
        .calculated { background-color: #f0f8ff; }
        .stress-calculated { background-color: #e8f5e9; }
        
        .btn { padding: 8px 16px; margin: 4px; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; transition: all 0.2s; font-family: 'Cairo'; }
        .btn-primary { background-color: #0066cc; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .btn-info { background-color: #17a2b8; color: white; }
        
        .header-logo { border: 2px solid #333; padding: 20px; text-align: center; }
        .header-logo h1 { font-size: 1.5rem; font-weight: 700; }
        .header-logo h2 { font-size: 1.1rem; color: #444; margin-top: 5px; }

        .tabs-nav { display: flex; border-bottom: 3px solid #0066cc; margin-bottom: 0; background: linear-gradient(to bottom, #f8f9fa, #e9ecef); border-radius: 8px 8px 0 0; }
        .tab-btn { flex: 1; padding: 15px 10px; text-align: center; cursor: pointer; border: none; border-right: 1px solid #dee2e6; transition: all 0.3s ease; position: relative; }
        .tab-btn.active { background: #0066cc; color: white; }
        .tab-btn.active .ar-text { color: white; }
        .tab-btn.active .en-sub { color: rgba(255, 255, 255, 0.85); }
        
        .tab-content { display: none; padding: 20px 0; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px; border-top: 2px solid #e9ecef; }
        .load-step-title { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 5px; margin: 15px 0 10px 0; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .load-step-title input { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; text-align: center; font-weight: bold; max-width: 200px; }
        
        .plate-info-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 15px; margin-bottom: 15px; color: white; }
        .plate-info-box input { background: rgba(255,255,255,0.9); border: none; border-radius: 4px; padding: 8px 12px; text-align: center; font-weight: bold; font-size: 1.1em; color: #333; }
        .global-actions { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border-radius: 8px; padding: 15px; margin: 15px 0; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        
        /* New styling for MPa input */
        .mpa-input { background-color: #fffde7 !important; border-bottom: 1px dashed #fbc02d !important; }
    </style>
</head>
<body class="p-4">
    <div class="report-container p-8">
        <div class="header-logo mb-6">
            <h1>
                <span class="ar-text">ØªÙ‚Ø±ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ­</span>
                <small class="en-sub" style="font-size: 0.7em;">PLATE LOAD TEST REPORT</small>
            </h1>
            <h2>
                <span class="ar-text" style="font-weight: 600;">ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…ÙˆØ§ØµÙØ© ASTM D1194</span>
                <small class="en-sub">According to ASTM D1194</small>
            </h2>
        </div>

        <div class="no-print mb-4 flex gap-2 justify-center flex-wrap">
            <button onclick="window.print()" class="btn btn-success">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±<br><small class="en-sub" style="color:#fff;">Print Report</small></button>
            <button onclick="generateChart()" class="btn btn-primary">ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ<br><small class="en-sub" style="color:#fff;">Update Chart</small></button>
        </div>

        <div class="section-title"><span class="ar-text">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><small class="en-sub">PROJECT INFORMATION</small></div>
        <table class="mb-4">
            <tr>
                <td class="label-cell w-1/4 bilingual-label"><span class="ar-text">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span><small class="en-sub">Project Name</small></td>
                <td><input type="text" id="projectName"></td>
                <td class="label-cell w-1/4 bilingual-label"><span class="ar-text">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</span><small class="en-sub">Order No.</small></td>
                <td><input type="text" id="orderNo"></td>
            </tr>
            <tr>
                <td class="label-cell bilingual-label"><span class="ar-text">Ø§Ù„Ø¹Ù…ÙŠÙ„</span><small class="en-sub">Client</small></td>
                <td><input type="text" id="client"></td>
                <td class="label-cell bilingual-label"><span class="ar-text">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span><small class="en-sub">Test Date</small></td>
                <td><input type="date" id="testDate"></td>
            </tr>
            <tr>
                <td class="label-cell bilingual-label"><span class="ar-text">Ø§Ù„Ù…ÙˆÙ‚Ø¹</span><small class="en-sub">Location</small></td>
                <td><input type="text" id="location"></td>
                <td class="label-cell bilingual-label"><span class="ar-text">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span><small class="en-sub">Report Date</small></td>
                <td><input type="date" id="reportDate"></td>
            </tr>
        </table>

        <div class="plate-info-box no-print">
            <div class="flex flex-wrap items-center justify-center gap-6">
                <div class="text-center">
                    <div class="label bilingual-label"><span class="ar-text" style="color:white;">Ù‚Ø·Ø± Ø§Ù„Ù„ÙˆØ­ (Ø³Ù…)</span><small class="en-sub" style="color:rgba(255,255,255,0.85);">Plate Diameter (cm)</small></div>
                    <input type="number" id="plateDiameter" value="45.72" step="0.1" min="1" oninput="calculatePlateArea()" style="width:120px;">
                </div>
                <div class="text-center text-3xl" style="color:rgba(255,255,255,0.7);">â†’</div>
                <div class="text-center">
                    <div class="label bilingual-label"><span class="ar-text" style="color:white;">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„ÙˆØ­ (Ø³Ù…Â²)</span><small class="en-sub" style="color:rgba(255,255,255,0.85);">Plate Area (cmÂ²)</small></div>
                    <input type="text" id="plateArea" readonly style="width:150px; background:#e8f4fc; color:#0066cc;">
                </div>
                <div class="text-center ml-4 pl-4 border-l border-white/30">
                     <div class="label bilingual-label"><span class="ar-text" style="color:#ffebb5;">Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</span><small class="en-sub" style="color:rgba(255,255,255,0.85);">Conversion Factor</small></div>
                     <input type="number" id="ramFactor" value="16.428" style="width:100px; color:#c62828;" title="ÙŠØªÙ… Ø¶Ø±Ø¨ Ø§Ù„Ù…ÙŠØ¬Ø§Ø¨Ø§Ø³ÙƒØ§Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù†">
                </div>
            </div>
        </div>

        <table class="mb-4" style="display:none;" id="plateInfoPrint">
            <tr>
                <td class="label-cell w-1/4 bilingual-label"><span class="ar-text">Ù‚Ø·Ø± Ø§Ù„Ù„ÙˆØ­ (Ø³Ù…)</span><small class="en-sub">Plate Diameter (cm)</small></td>
                <td id="plateDiameterPrint">45.72</td>
                <td class="label-cell w-1/4 bilingual-label"><span class="ar-text">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù„ÙˆØ­ (Ø³Ù…Â²)</span><small class="en-sub">Plate Area (cmÂ²)</small></td>
                <td id="plateAreaPrint">1641.73</td>
            </tr>
        </table>

        <div class="global-actions no-print">
            <button onclick="calculateAllResults()" class="btn btn-info">ğŸ”„ Ø­Ø³Ø§Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬<br><small class="en-sub" style="color:#fff;">Calculate All Results</small></button>
            <button onclick="resetNewTest()" class="btn btn-danger">ğŸ—‘ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†<br><small class="en-sub" style="color:#fff;">Reset Test</small></button>
        </div>

        <div class="tabs-nav no-print" id="tabsNav">
            <button class="tab-btn active" onclick="switchTab(1)" id="tab1Btn"><span class="tab-indicator">1</span> <span class="ar-text">Ø§Ù„Ù‚Ø³Ù… Ø£ - Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</span><small class="en-sub">Section A - Loading Stage</small></button>
            <button class="tab-btn" onclick="switchTab(2)" id="tab2Btn"><span class="tab-indicator">2</span> <span class="ar-text">Ø§Ù„Ù‚Ø³Ù… Ø¨ - Ù…Ø±Ø­Ù„Ø© Ø±ÙØ¹ Ø§Ù„Ø­Ù…Ù„</span><small class="en-sub">Section B - Unloading Stage</small></button>
            <button class="tab-btn" onclick="switchTab(3)" id="tab3Btn"><span class="tab-indicator">3</span> <span class="ar-text">Ø§Ù„Ù‚Ø³Ù… Ø¬ - Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ù…Ù†Ø­Ù†ÙŠØ§Øª</span><small class="en-sub">Section C - Results & Curves</small></button>
        </div>

        <div class="tab-content active" id="tab1Content">
            <div class="section-title"><span class="ar-text">Ø£- Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</span><small class="en-sub">A- LOADING STAGE</small></div>
            
            <div class="load-step-title" id="loadingTitle1">
                <div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div>
                <input type="text" id="loadingStageLabel1" value="0.70 kg/cmÂ²">
            </div>
            <div class="no-print mb-2 mt-2 text-center">
                <button onclick="addLoadingRow('loading1')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
                <button onclick="removeLastRow('loading1Body')" class="btn btn-danger">- Ø­Ø°Ù</button>
            </div>
            <table id="loading1Table" class="mb-4">
                <thead>
                    <tr>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„ÙˆÙ‚Øª</span><small class="en-sub">Time</small></th>
                        <th class="bilingual-label bg-yellow-50"><span class="ar-text">Ø§Ù„Ø¶ØºØ· (MPa)</span><small class="en-sub">Pressure</small></th>
                        <th class="bilingual-label bg-gray-50"><span class="ar-text">Ø§Ù„Ø­Ù…Ù„ (Ø·Ù†)</span><small class="en-sub">Load (ton)</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ø¹Ø¯Ø§Ø¯ 1</span><small class="en-sub">Gauge 1</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ø¹Ø¯Ø§Ø¯ 2</span><small class="en-sub">Gauge 2</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ø¹Ø¯Ø§Ø¯ 3</span><small class="en-sub">Gauge 3</small></th>
                        <th class="calculated bilingual-label"><span class="ar-text">Ø§Ù„Ù…ØªÙˆØ³Ø·</span><small class="en-sub">Avg</small></th>
                        <th class="calculated bilingual-label"><span class="ar-text">Ø§Ù„Ù‡Ø¨ÙˆØ·</span><small class="en-sub">Sett. (mm)</small></th>
                        <th class="stress-calculated bilingual-label"><span class="ar-text">Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ø­Ø±Ø§Ø±Ø©</span><small class="en-sub">Temp</small></th>
                        <th class="no-print bilingual-label">X</th>
                    </tr>
                </thead>
                <tbody id="loading1Body"></tbody>
            </table>

            <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="loadingStageLabel2" value="1.40 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addLoadingRow('loading2')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('loading2Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="loading2Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="loading2Body"></tbody>
            </table>

            <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="loadingStageLabel3" value="2.10 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addLoadingRow('loading3')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('loading3Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="loading3Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="loading3Body"></tbody>
            </table>

            <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="loadingStageLabel4" value="2.80 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addLoadingRow('loading4')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('loading4Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="loading4Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="loading4Body"></tbody>
            </table>

             <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="loadingStageLabel5" value="3.50 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addLoadingRow('loading5')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('loading5Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="loading5Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="loading5Body"></tbody>
            </table>

             <div class="load-step-title"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="loadingStageLabel6" value="4.20 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addLoadingRow('loading6')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('loading6Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="loading6Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="loading6Body"></tbody>
            </table>

            <div class="nav-buttons no-print"><div></div><button onclick="switchTab(2)" class="btn btn-primary btn-nav"><span class="ar-text">Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</span> â†’</button></div>
        </div>

        <div class="tab-content" id="tab2Content">
            <div class="section-title"><span class="ar-text">Ø¨- Ù…Ø±Ø­Ù„Ø© Ø±ÙØ¹ Ø§Ù„Ø­Ù…Ù„</span><small class="en-sub">B- UNLOADING STAGE</small></div>

            <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="unloadingStageLabel1" value="2.80 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addUnloadingRow('unloading1')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('unloading1Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="unloading1Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="unloading1Body"></tbody>
            </table>

            <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="unloadingStageLabel2" value="1.40 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addUnloadingRow('unloading2')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('unloading2Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="unloading2Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="unloading2Body"></tbody>
            </table>

            <div class="load-step-title" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><div class="bilingual-label"><span class="ar-text">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯</span><small class="en-sub">Stress Level</small></div><input type="text" id="unloadingStageLabel3" value="0.00 kg/cmÂ²"></div>
            <div class="no-print mb-2 mt-2 text-center"><button onclick="addUnloadingRow('unloading3')" class="btn btn-primary">+ Ø¥Ø¶Ø§ÙØ© ØµÙ</button><button onclick="removeLastRow('unloading3Body')" class="btn btn-danger">- Ø­Ø°Ù</button></div>
            <table id="unloading3Table" class="mb-4">
                <thead><tr><th class="bilingual-label">Ø§Ù„ÙˆÙ‚Øª<br><small>Time</small></th><th class="bilingual-label bg-yellow-50">Ø§Ù„Ø¶ØºØ·<br><small>MPa</small></th><th class="bilingual-label bg-gray-50">Ø§Ù„Ø­Ù…Ù„<br><small>Ton</small></th><th>G1</th><th>G2</th><th>G3</th><th class="calculated">Avg</th><th class="calculated">Sett.</th><th class="stress-calculated">Stress</th><th>Temp</th><th class="no-print">X</th></tr></thead>
                <tbody id="unloading3Body"></tbody>
            </table>

            <div class="nav-buttons no-print">
                <button onclick="switchTab(1)" class="btn btn-warning btn-nav">â† <span class="ar-text">Ø§Ù„Ø³Ø§Ø¨Ù‚</span></button>
                <button onclick="switchTab(3)" class="btn btn-primary btn-nav"><span class="ar-text">Ø§Ù„ØªØ§Ù„ÙŠ</span> â†’</button>
            </div>
        </div>

        <div class="tab-content" id="tab3Content">
            <div class="section-title"><span class="ar-text">Ù…Ù„Ø®Øµ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span><small class="en-sub">SUMMARY OF TEST RESULTS</small></div>
            <div class="no-print mb-2 mt-2 text-center">
                <button onclick="addSummaryRow()" class="btn btn-primary">+ ØµÙ</button>
                <button onclick="autoFillSummary()" class="btn btn-success">âš¡ ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙˆØ±Ø³Ù…</button>
            </div>
            <table id="summaryTable">
                <thead>
                    <tr>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</span><small class="en-sub">Stage</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ø­Ù…Ù„ (Ø·Ù†)</span><small class="en-sub">Load (ton)</small></th>
                        <th class="calculated bilingual-label"><span class="ar-text">Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ (ÙƒØ¬Ù…/Ø³Ù…Â²)</span><small class="en-sub">Stress (kg/cmÂ²)</small></th>
                        <th class="bilingual-label"><span class="ar-text">Ø§Ù„Ù‡Ø¨ÙˆØ· (Ù…Ù…)</span><small class="en-sub">Settlement (mm)</small></th>
                        <th class="no-print bilingual-label">X</th>
                    </tr>
                </thead>
                <tbody id="summaryBody"></tbody>
            </table>

            <div class="section-title page-break mt-6"><span class="ar-text">Ø¬- Ø§Ù„Ù…Ù†Ø­Ù†ÙŠØ§Øª</span><small class="en-sub">C- CURVES (Stress vs Settlement)</small></div>
            <div class="mt-4 p-4 border border-gray-300" style="height: 500px;">
                <canvas id="stressSettlementChart"></canvas>
            </div>

            <div class="nav-buttons no-print">
                <button onclick="switchTab(2)" class="btn btn-warning btn-nav">â† <span class="ar-text">Ø§Ù„Ø³Ø§Ø¨Ù‚</span></button>
                <div></div>
            </div>
        </div>

        <div class="mt-8 pt-4 border-t-2 border-gray-400">
            <table class="signature-section" style="border:none;">
                <tr style="border:none;">
                    <td class="w-1/3 text-center p-4" style="border:none;"><div class="border-t border-black pt-2 mt-8"><span class="ar-text">ÙØ­Øµ Ø¨ÙˆØ§Ø³Ø·Ø©</span><small class="en-sub">Tested By</small></div></td>
                    <td class="w-1/3 text-center p-4" style="border:none;"><div class="border-t border-black pt-2 mt-8"><span class="ar-text">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©</span><small class="en-sub">Checked By</small></div></td>
                    <td class="w-1/3 text-center p-4" style="border:none;"><div class="border-t border-black pt-2 mt-8"><span class="ar-text">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø©</span><small class="en-sub">Approved By</small></div></td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        let rowCounters = {};
        let summaryRowCount = 0;
        let chart = null;

        function calculatePlateArea() {
            const diameter = parseFloat(document.getElementById('plateDiameter').value);
            if (!isNaN(diameter) && diameter > 0) {
                const area = Math.PI * Math.pow(diameter / 2, 2);
                document.getElementById('plateArea').value = area.toFixed(2);
                document.getElementById('plateDiameterPrint').textContent = diameter;
                document.getElementById('plateAreaPrint').textContent = area.toFixed(2);
            }
        }
        function getPlateArea() {
            const areaValue = parseFloat(document.getElementById('plateArea').value);
            return isNaN(areaValue) ? 1641.73 : areaValue;
        }
        function switchTab(tabNumber) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab${tabNumber}Content`).classList.add('active');
            document.getElementById(`tab${tabNumber}Btn`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (tabNumber === 3) setTimeout(generateChart, 100);
        }

        document.addEventListener('DOMContentLoaded', function() {
            calculatePlateArea(); // Calc initial area
            // Init counters & Rows
            for (let i = 1; i <= 6; i++) { rowCounters[`loading${i}`] = 0; addLoadingRow(`loading${i}`); addLoadingRow(`loading${i}`); }
            for (let i = 1; i <= 3; i++) { rowCounters[`unloading${i}`] = 0; addUnloadingRow(`unloading${i}`); addUnloadingRow(`unloading${i}`); }
            addSummaryRow();
            document.getElementById('reportDate').valueAsDate = new Date();
            document.getElementById('plateInfoPrint').style.display = 'table';
            
            // Register DataLabels
            Chart.register(ChartDataLabels);
            generateChart();
        });

        // --- ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ù†Ø© MPa ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ---
        function addLoadingRow(tableId) {
            if (!rowCounters[tableId]) rowCounters[tableId] = 0;
            rowCounters[tableId]++;
            const tbody = document.getElementById(`${tableId}Body`);
            const row = document.createElement('tr');
            row.id = `${tableId}-row-${rowCounters[tableId]}`;
            row.innerHTML = `
                <td><input type="text" class="print-compact" placeholder="HH:MM"></td>
                <td class="bg-yellow-50"><input type="number" step="0.001" class="mpa-input print-compact" oninput="calculateRow(this)" placeholder="MPa"></td>
                <td class="bg-gray-50"><input type="number" step="0.01" class="load-input print-compact" onchange="calculateRow(this)" readonly></td>
                <td><input type="number" step="0.001" class="gauge-input print-compact" onchange="calculateRow(this)"></td>
                <td><input type="number" step="0.001" class="gauge-input print-compact" onchange="calculateRow(this)"></td>
                <td><input type="number" step="0.001" class="gauge-input print-compact" onchange="calculateRow(this)"></td>
                <td class="calculated average-cell">-</td>
                <td class="calculated settlement-cell">-</td>
                <td class="stress-calculated stress-cell">-</td>
                <td><input type="number" step="0.1" class="print-compact" placeholder="Â°C"></td>
                <td class="no-print"><button onclick="removeRow('${row.id}')" class="btn btn-danger btn-sm" style="padding:0px 6px;">âœ•</button></td>
            `;
            tbody.appendChild(row);
        }

        function addUnloadingRow(tableId) {
            // Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø§Ù„Ø¸Ø¨Ø·
            addLoadingRow(tableId);
        }

        // --- ØªØ¹Ø¯ÙŠÙ„: Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ØªØ­ÙˆÙŠÙ„ MPa Ù„Ù€ Ø·Ù† ---
        function calculateRow(input) {
            const row = input.closest('tr');
            const gaugeInputs = row.querySelectorAll('.gauge-input');
            const loadInput = row.querySelector('.load-input');
            const mpaInput = row.querySelector('.mpa-input');
            
            // 1. ØªØ­ÙˆÙŠÙ„ MPa Ù„Ù€ Ø·Ù†
            if (mpaInput && mpaInput.value !== '') {
                const factor = parseFloat(document.getElementById('ramFactor').value) || 16.428;
                loadInput.value = (parseFloat(mpaInput.value) * factor).toFixed(2);
            }

            // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø· ÙˆØ§Ù„Ù‡Ø¨ÙˆØ·
            let sum = 0, count = 0;
            gaugeInputs.forEach(g => { if(g.value!=='') { sum+=parseFloat(g.value); count++; } });
            
            if (count === 3) {
                const avg = sum / 3;
                row.querySelector('.average-cell').textContent = avg.toFixed(3);
                row.querySelector('.settlement-cell').textContent = (avg * 0.001).toFixed(3);
            }

            // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯
            if (loadInput && loadInput.value !== '') {
                const load = parseFloat(loadInput.value);
                const area = getPlateArea();
                row.querySelector('.stress-cell').textContent = ((load * 1000) / area).toFixed(2);
            }
        }

        // --- ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù…Ø© Ù„Ø­Ø¸ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ ---
        function addSummaryRow() {
            summaryRowCount++;
            const tbody = document.getElementById('summaryBody');
            const row = document.createElement('tr');
            row.id = `summary-row-${summaryRowCount}`;
            row.innerHTML = `
                <td><select class="stage-select print-compact" onchange="generateChart()" style="border:none;background:transparent;"><option value="Loading">ØªØ­Ù…ÙŠÙ„</option><option value="Unloading">Ø±ÙØ¹</option></select></td>
                <td><input type="number" step="0.01" class="load-input print-compact" oninput="calculateStressSummary(this)"></td>
                <td class="calculated stress-cell">-</td>
                <td><input type="number" step="0.001" class="settlement-input print-compact" oninput="generateChart()"></td>
                <td class="no-print"><button onclick="removeRow('${row.id}'); generateChart()" class="btn btn-danger btn-sm">âœ•</button></td>
            `;
            tbody.appendChild(row);
        }

        function calculateStressSummary(input) {
            const row = input.closest('tr');
            const load = parseFloat(input.value);
            if (!isNaN(load)) {
                const area = getPlateArea();
                row.querySelector('.stress-cell').textContent = ((load * 1000) / area).toFixed(2);
            }
            generateChart(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù…Ø© ÙÙˆØ±Ø§Ù‹
        }

        function autoFillSummary() {
            document.getElementById('summaryBody').innerHTML = '';
            summaryRowCount = 0;
            
            // 1. Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ø§Ù„ØµÙØ± (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)
            addSummaryRow();
            let r = document.getElementById(`summary-row-${summaryRowCount}`);
            r.querySelector('.stage-select').value = 'Loading';
            r.querySelector('.load-input').value = '0.00';
            r.querySelector('.settlement-input').value = '0.000';
            r.querySelector('.stress-cell').textContent = '0.00';

            // 2. Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            for (let i = 1; i <= 6; i++) {
                const rows = document.querySelectorAll(`#loading${i}Body tr`);
                if (rows.length > 0) {
                    const last = rows[rows.length - 1]; // Ø¢Ø®Ø± Ù‚Ø±Ø§Ø¡Ø©
                    if (last.querySelector('.load-input').value) {
                        addSummaryRow();
                        r = document.getElementById(`summary-row-${summaryRowCount}`);
                        r.querySelector('.stage-select').value = 'Loading';
                        r.querySelector('.load-input').value = last.querySelector('.load-input').value;
                        r.querySelector('.settlement-input').value = last.querySelector('.settlement-cell').textContent;
                        r.querySelector('.stress-cell').textContent = last.querySelector('.stress-cell').textContent;
                    }
                }
            }
            // 3. Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø±ÙØ¹
            for (let i = 1; i <= 3; i++) {
                const rows = document.querySelectorAll(`#unloading${i}Body tr`);
                if (rows.length > 0) {
                    const last = rows[rows.length - 1];
                    if (last.querySelector('.load-input').value) {
                        addSummaryRow();
                        r = document.getElementById(`summary-row-${summaryRowCount}`);
                        r.querySelector('.stage-select').value = 'Unloading';
                        r.querySelector('.load-input').value = last.querySelector('.load-input').value;
                        r.querySelector('.settlement-input').value = last.querySelector('.settlement-cell').textContent;
                        r.querySelector('.stress-cell').textContent = last.querySelector('.stress-cell').textContent;
                    }
                }
            }
            generateChart();
        }

        // --- ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (Ù…Ù‚Ù„ÙˆØ¨ + Ø£Ø±Ù‚Ø§Ù… + Ù…Ø­ÙˆØ± Ø¹Ù„ÙˆÙŠ) ---
        function generateChart() {
            const rows = document.querySelectorAll('#summaryBody tr');
            const loadingData = [], unloadingData = [];
            
            rows.forEach(row => {
                const stage = row.querySelector('.stage-select').value;
                const stress = parseFloat(row.querySelector('.stress-cell').textContent);
                const sett = parseFloat(row.querySelector('.settlement-input').value);
                
                if (!isNaN(stress) && !isNaN(sett)) {
                    const pt = { x: stress, y: sett };
                    if (stage === 'Loading') loadingData.push(pt); 
                    else unloadingData.push(pt);
                }
            });

            // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¹Ø´Ø§Ù† Ø§Ù„Ø®Ø· ÙŠØªØ±Ø³Ù… ØµØ­
            loadingData.sort((a,b) => a.x - b.x);
            unloadingData.sort((a,b) => b.x - a.x);

            const ctx = document.getElementById('stressSettlementChart').getContext('2d');
            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Loading', 
                            data: loadingData,
                            // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù‡Ù†Ø§ (Ø£Ø­Ù…Ø± ÙˆØ£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚) ---
                            borderColor: '#1F4E79',       // Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ Ù„Ù„Ø®Ø·
                            backgroundColor: '#C00000',   // Ø£Ø­Ù…Ø± Ù„Ù„Ù†Ù‚Ø·Ø©
                            pointBackgroundColor: '#C00000', 
                            pointBorderColor: '#C00000',
                            pointStyle: 'rectRot',        // Ø´ÙƒÙ„ Ù…Ø¹ÙŠÙ†
                            pointRadius: 5,
                            borderWidth: 2,
                            tension: 0,
                            fill: false
                        },
                        {
                            label: 'Unloading', 
                            data: unloadingData,
                            // --- Ø§Ù„Ø®Ø· Ø§Ù„Ø±Ø§Ø¬Ø¹ (Ù…ØªØµÙ„ ÙˆÙ„ÙˆÙ†Ù‡ Ø£Ø²Ø±Ù‚) ---
                            borderColor: '#1F4E79',       // Ù†ÙØ³ Ø§Ù„Ø£Ø²Ø±Ù‚
                            backgroundColor: '#C00000',   // Ù†ÙØ³ Ø§Ù„Ø£Ø­Ù…Ø±
                            pointBackgroundColor: '#C00000',
                            pointBorderColor: '#C00000',
                            pointStyle: 'rectRot',
                            pointRadius: 5,
                            borderWidth: 2,
                            borderDash: [],               // << Ø´ÙŠÙ„Ù†Ø§ Ø§Ù„ØªÙ†Ù‚ÙŠØ· Ø¹Ø´Ø§Ù† ÙŠØ¨Ù‚Ù‰ Ù…ØªØµÙ„ Solid
                            tension: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true, 
                    maintainAspectRatio: false,
                    layout: { padding: { top: 30, right: 30, left: 10, bottom: 10 } },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                        datalabels: {
                            display: true, 
                            align: 'right', 
                            anchor: 'center', 
                            offset: 6,
                            color: '#000',
                            font: { weight: 'bold', size: 11 },
                            formatter: (v) => v.y.toFixed(3)
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear', 
                            position: 'top',
                            title: { display: true, text: 'Stress (kg/cmÂ²)', font: {weight:'bold', size: 12}, color: '#000' },
                            min: 0, 
                            max: 4.5,
                            grid: { color: '#000', lineWidth: 0.5 }, // Ø§Ù„Ø´Ø¨ÙƒØ© Ø³ÙˆØ¯Ø§Ø¡
                            ticks: { color: '#000', font: {weight:'bold'} }
                        },
                        y: {
                            reverse: true,
                            title: { display: true, text: 'Settlement (mm)', font: {weight:'bold', size: 12}, color: '#000' },
                            min: 0,
                            grid: { color: '#000', lineWidth: 0.5 }, // Ø§Ù„Ø´Ø¨ÙƒØ© Ø³ÙˆØ¯Ø§Ø¡
                            ticks: { color: '#000', font: {weight:'bold'} }
                        }
                    }
                }
            });
        }

        function removeRow(id) { document.getElementById(id)?.remove(); }
        function removeLastRow(id) { const b = document.getElementById(id); if(b.lastChild) b.removeChild(b.lastChild); }
        function resetNewTest() { if(confirm('Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) location.reload(); }
        function calculateAllResults() { autoFillSummary(); alert('ØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«'); }
    </script>
</body>
</html>

